/* CboxFresh 2015-02-27 */
window.DualListPicker=function(){var t=function(t,e,i){this._initialize(t,e,i),this.render(),this._attachListeners()};return t.fn=t.prototype,t.fn._initialize=function(t,e,i){this.el=t,this.options=e,this.config=i},t.fn.getAllOptions=function(){return this.options},t.fn.getAvailableOptions=function(){return this.getAllOptions().filter(function(t){return!t.selected})},t.fn.getSelectedOptions=function(){return this.getAllOptions().filter(function(t){return t.selected})},t.fn.moveItems=function(t){var e=function(e){var i="selected"===t,n=this;e.forEach(function(t){for(var e=0;n.options.length>e;e++)if(n.options[e].id===parseInt(t.id,10)){n.options[e].selected=i;break}}),this.refresh(),"function"==typeof this.config.onUpdate&&this.config.onUpdate({selected:this.getSelectedOptions(),available:this.getAvailableOptions(),all:this.getAllOptions()})}.bind(this);return e},t.fn.render=function(){this.el.className=this.el.className+" "+DualListPicker.Constants.PICKER_CLASSNAME,this.availablePicker=new t.MultiSelectBox(this,{clearSearchButtonContent:this.config.clearSearchButtonContent,buttonContent:this.config.addButtonContent||"Add",buttonAction:this.moveItems("selected"),placeholderText:this.config.availablePlaceholderText,className:"available-"+DualListPicker.Constants.SELECTBOX_CLASSNAME,labelText:this.config.availableLabelText}),this.selectedPicker=new t.MultiSelectBox(this,{clearSearchButtonContent:this.config.clearSearchButtonContent,buttonContent:this.config.removeButtonContent||"Remove",buttonAction:this.moveItems("available"),placeholderText:this.config.selectedPlaceholderText,className:"selected-"+DualListPicker.Constants.SELECTBOX_CLASSNAME,labelText:this.config.selectedLabelText}),this.el.appendChild(this.availablePicker.el,this.el),this.el.appendChild(this.selectedPicker.el,this.el),this.availablePicker.setOptions(this.getAvailableOptions()),this.selectedPicker.setOptions(this.getSelectedOptions()),this.availablePicker.refresh(),this.selectedPicker.refresh()},t.fn.refresh=function(){this.availablePicker.setOptions(this.getAvailableOptions()),this.selectedPicker.setOptions(this.getSelectedOptions()),this.availablePicker.refresh(),this.selectedPicker.refresh()},t.fn._attachListeners=function(){},t}(),function(t){var e={};e.attachEventListener=function(t,e,i,n){function s(){t.removeEventListener(e,i,n)}return t.addEventListener(e,i,n),{remove:s}},t.Utils=e}(DualListPicker||{}),function(t){var e={};e.PICKER_CLASSNAME="dual-list-picker",e.SELECTBOX_CLASSNAME="select-box",e.FILTER_LABEL_CLASSNAME="filter-label",e.CLEAR_BUTTON_CLASSNAME="clear-button",t.Constants=e}(DualListPicker||{}),function(t,e,i){var n=function(t,e){this._listeners=[],this.dlInstance=t,this._initialize(e),this.render(),this.attachListeners()};n.fn=n.prototype,n.fn._initialize=function(t){this.options=[],this.config=t},n.fn.render=function(){this.el=document.createElement("div"),this.el.className=this.el.className+" "+this.config.className,this.picker=document.createElement("select"),this.picker.multiple=!0,this.filterLabel=document.createElement("span"),this.filterLabel.className=i.FILTER_LABEL_CLASSNAME,this.filterLabel.innerText=this.getFilterLabelText();var t=document.createElement("div");t.className="search-wrapper",this.searchBox=document.createElement("input"),this.searchBox.type="search",this.searchBox.placeholder=this.config.placeholderText||"Search",this.clearSearchButton=document.createElement("button"),this.clearSearchButton.className=i.CLEAR_BUTTON_CLASSNAME,this.clearSearchButton.style.display="none",this.clearSearchButton.type="button",this.clearSearchButton.innerHTML=this.config.clearSearchButtonContent||"x",this.pickerButton=document.createElement("button"),this.pickerButton.innerHTML=this.config.buttonContent,this.pickerButton.type="button",t.appendChild(this.searchBox),t.appendChild(this.clearSearchButton),this.el.appendChild(t),this.el.appendChild(this.filterLabel),this.el.appendChild(this.picker),this.el.appendChild(this.pickerButton)},n.fn.updateFilterOptions=function(t){var e=this;this.filterActive=!!t,this.filterText=t,this.filterOptions=this.options.filter(function(t){return e.filterText&&t.displayName&&t.displayName.toLowerCase().match(e.filterText.toLowerCase())})},n.fn.getFilterLabelText=function(){return this.options?this.config.labelText+" ("+this.options.length+")":void 0},n.fn.getFilterOptions=function(){return this.filterOptions},n.fn.refresh=function(){this.updateFilterOptions(this.filterText);var t=this.filterActive?this.getFilterOptions():this.options;this.picker.innerHTML="",this.picker.innerHTML=this.generateOptionsStringFromOptions(t),this.filterLabel.innerText=this.getFilterLabelText()},n.fn.generateOptionsStringFromOptions=function(t){var e="";return t.forEach(function(t){e+='<option rel="'+t.id+'">'+t.displayName+"</option>"}),e},n.fn.deselectAll=function(){this.getFilterOptions().forEach(function(t){t.selected=!1}),this.options.forEach(function(t){t.selected=!1})},n.fn.updateOptionsFromDom=function(){var t=Array.prototype.slice.call(this.picker.options);this.options=t.map(function(t){return{displayName:t.text,selected:t.selected,id:t.attributes.rel.value}})},n.fn.getSelectedOptions=function(){return this.options.filter(function(t){return t.selected})},n.fn.buttonClicked=function(){this.updateOptionsFromDom(),this.config.buttonAction.call(this.dlInstance,this.getSelectedOptions())},n.fn.searchSubmitted=function(t){t&&t.preventDefault(),this.updateFilterOptions(this.searchBox.value),this.refresh()},n.fn.clearSearch=function(){this.searchBox.value="",this.searchSubmitted(),this.clearSearchButton.style.display="none"},n.fn.hideShowClearButton=function(){this.clearSearchButton.style.display=this.searchBox.value?"inline-block":"none"},n.fn.setOptions=function(t){this.options=t},n.fn.attachListeners=function(){var t=e.attachEventListener(this.pickerButton,"click",this.buttonClicked.bind(this));this._listeners.push(t);var i=e.attachEventListener(this.picker,"dblclick",this.buttonClicked.bind(this));this._listeners.push(i);var n=e.attachEventListener(this.searchBox,"search",this.searchSubmitted.bind(this));this._listeners.push(n);var s=e.attachEventListener(this.searchBox,"keyup",this.hideShowClearButton.bind(this));this._listeners.push(s);var l=e.attachEventListener(this.clearSearchButton,"click",this.clearSearch.bind(this));this._listeners.push(l)},n.fn.removeAllListeners=function(){for(;this._listeners.length;)this._listeners.pop().remove()},t.MultiSelectBox=n}(DualListPicker||{},DualListPicker.Utils,DualListPicker.Constants);